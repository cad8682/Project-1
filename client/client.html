<!DOCTYPE html>
<html lang="en">
<head>
  <title>Our simple HTTP server</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
  
  <script>
    //Handles our FETCH response. This function is async because it
    //contains an await.
    const handleResponse = async (response) => {
      
      //Grab the content section
      const content = document.querySelector('#content');

      //Based on the status code, display something
      switch(response.status) {
        case 200: // Success
          content.innerHTML = `<b>Success</b>`;
          break;
        case 201: // Created
          content.innerHTML = '<b>Created</b>';
          break;
        case 204: // Updated (no response back from server)
          content.innerHTML = '<b>Updated (No Content)</b>';
          break;
          return;
        case 400: // Bad request
          content.innerHTML = `<b>Bad Request</b>`;
          break;
        case 401: // Unauthorized
          content.innerHTML = `<b>Unauthorized</b>`;
          break;
        case 403: //Forbidden
          content.innerHTML = `<b>Forbidden</b>`;
          break;
        case 500: //Internal error
          content.innerHTML = `<b>Internal</b>`;
          break;
        case 501: //Not implemented
          content.innerHTML = `<b>Not Implemented</b>`;
          break;
        default : //404 not found
          content.innerHTML = `<b>Resource Not Found</b>`;
          break;
      }

      //Parse the response to json. This works because we know the server always
      //sends back json. Await because .json() is an async function.
      let obj = {};
      console.log(response.method);
      if (response.status !== 204 && method !== 'HEAD') {
        obj = await response.json();
      }

      //If we have a message, display it.
      console.log(obj);
      if (obj.message) {
        content.innerHTML += `<p>${obj.message}</p>`;
      }
      //If there's an id, display it
      if (obj.id) {
        content.innerHTML += `<p>${obj.id}</p>`;
      }
      //If there's a user added, display it
      //if (obj.user) {
        //content.innerHTML += `<p>${JSON.stringify(obj.user)}</p>`;
      //}
      //If there are multiple users called, display them
      //if (obj.users) {
        //content.innerHTML += `<p>${JSON.stringify(obj.users)}</p>`;
      //}
    }

    //Init function is called when window.onload runs (set below).
    const init = () => {
      const nameSelector = document.querySelector('#nameField');
      const numberSelector = document.querySelector('#numberField');
      const typeOneSelector = document.querySelector('#tyepOneField');
      const typeTwoSelector = document.querySelector('#tyepTwoField');
      const wMinSelector = document.querySelector('#wMinField');
      const wMaxSelector = document.querySelector('#wMaxField');
      const hMinSelector = document.querySelector('#hMinField');
      const hMaxSelector = document.querySelector('#hMaxField');
      const weaknessSelector = document.querySelector('#weaknessField');

      const addMonButton = document.querySelector('#addMon');
      const getMonButton = document.querySelector('#getMon');
      //const getURLField = document.querySelector('#urlField');
      const getMethodSelect = document.querySelector('#methodSelect');

      const searchDexUrl = document.querySelector('#searchPokedexForm');
      console.log(searchDexUrl.method);

      //Handles the post call to make a user
      const onSubmitAdd = async (e) => {
        e.preventDefault();
        const formData = `name=${nameField.value}&number=${numberField.value}&type1=${typeOne.value}&type2=${typeTwoField.value}&weightMin=${wMinField.value}&weightMax=${wMaxField.value}&heightMin=${hMinField.value}&heightMax=${hMaxField.value}&weakness=${weaknessField.value}`;
        let response = await fetch('/addMon', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'Accept': 'application/json',
          },
          body: formData
        });
        handleResponse(response, getMethodSelect.value);
      }

      //Handles the get users call handle the get / head requests
      const onSubmitGet = async (e) => {
        e.preventDefault();
        let response = await fetch(getURLField.value, {
          method: getMethodSelect.value,
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'Accept': 'application/json',
          }
        });
        handleResponse(response, getMethodSelect.value);
      }

      //Call onSubmit when the submit event fires on the form.
      addMonButton.addEventListener('click', onSubmitAdd);
      getMonButton.addEventListener('click', onSubmitGet);
    };

    //When the window loads, run init.
    window.onload = init;
  </script>
</head>
<body>
    <!--searchPokedex-->
    <div class="endpoint">
        <h2>/api/searchPokedex</h2>
        <form id="searchPokedexForm" action="/searchPokedex" method="get">
            <label>
                Name: 
                <input id="nameField" type="text" name = "name">
            </label>
            <label>
                Number: 
                <input id="numberField" type="number" name = "number">
            </label>
            <label>
                Type 1: 
                <input id="typeOneField" type="text" name = "type1">
            </label>
            <label>
                Type 2: 
                <input id="typeTwoField" type="text" name = "type2">
            </label>
            <label>
                Weight Minimum: 
                <input id="wMinField" type="text" name = "weightMin">
            </label>
            <label>
                Weight Maximum: 
                <input id="wMaxField" type="text" name = "weightMax">
            </label>
            <label>
                Height Minimum: 
                <input id="hMinField" type="text" name = "heightMin">
            </label>
            <label>
                Height Maximum: 
                <input id="hMaxField" type="text" name = "heightMax">
            </label>
            <label>
                Weakness: 
                <input id="weaknessField" type="text" name = "weakness">
            </label>
            <select id="methodSelect">
                <option value="GET">GET</option>
                <option value="HEAD">HEAD</option>
            </select>
            <input id="getMon" type="submit" value="Get Pokemon" />
        </form>
    </div>
    <!--getType-->
    <div class="endpoint">
        <h2>/api/getTypes</h2> <!-- Just one? -->
        <form id="getTypesForm" action="/getTypes" method="get">
            <label>
                Type 1: 
                <input type="text" name = "type1">
            </label>
            <label>
                Type 2: 
                <input type="text" name = "type2">
            </label>
            <select id="methodSelect">
                <option value="GET">GET</option>
                <option value="HEAD">HEAD</option>
            </select>
            <input id="getMon" type="submit" value="Get Pokemon" />
        </form>
    </div>
    <!--getShiny-->
    <div class="endpoint">
        <h2>/api/getShiny</h2>
        <form> <!-- Just one? -->
            <label>
                Name: 
                <input type="text" name = "name">
            </label>
            <label>
                Number: 
                <input type="number" name = "number">
            </label>
        </form>
    </div>
    <!--getCostumes-->
    <div class="endpoint">
        <h2>/api/getCostumes</h2>
        <form> <!-- Just one? -->
            <label>
                Name: 
                <input type="text" name = "name">
            </label>
            <label>
                Number: 
                <input type="number" name = "number">
            </label>
        </form>
    </div>
    <!--getMegas-->
    <div class="endpoint">
        <h2>/api/getMegas</h2>
        <form> <!-- Just one? -->
            <label>
                Name: 
                <input type="text" name = "name">
            </label>
            <label>
                Number: 
                <input type="number" name = "number">
            </label>
        </form>
    </div>
    <!--getGigantamax-->
    <div class="endpoint">
        <h2>/api/getGigantamax</h2>
        <form> <!-- Just one? -->
            <label>
                Name: 
                <input type="text" name = "name">
            </label>
            <label>
                Number: 
                <input type="number" name = "number">
            </label>
        </form>
    </div>
     <!--getRandom-->
     <div class="endpoint">
        <h2>/api/getRandom</h2>
        <form>
            <label>
                Number: 
                <input type="number" name = "number">
            </label>
        </form>
    </div>
    <!--addPokemon-->
    <div class="endpoint">
        <h2>/api/addPokemon</h2>
        <form id="addPokemonForm" action="/addPokemon" method="post">
            <label>
                Name: 
                <input type="text" name = "name">
            </label>
            <label>
                Number: 
                <input type="number" name = "number">
            </label>
            <label>
                Type 1: 
                <input type="text" name = "type1">
            </label>
            <label>
                Type 2: 
                <input type="text" name = "type2">
            </label>
            <label>
                Weight: 
                <input type="text" name = "weight">
            </label>
            <label>
                Height: 
                <input type="text" name = "height">
            </label>
            <!-- Unknown number of weaknesses -->
            <label>
                Weakness: 
                <input type="text" name = "weakness">
            </label>
            <input id="addMon" type="submit" value="Add Pokemon" />
        </form>
    </div>
    <!--removePokemon--> <!--Necessary? Yay Nay??? -->
    <div class="endpoint">
        <h2>/api/removePokemon</h2>
        <form>
            <label>
                Number: 
                <input type="number" name = "number">
            </label>
        </form>
    </div>
</section>
<section id="content">
</section>
</body>
</html>
